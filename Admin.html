<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel ‚Äì Cricket Auction</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#0f2027;color:#fff}
header{text-align:center;padding:12px;background:#111;font-size:20px;font-weight:bold}
nav{display:flex;background:#1b2a30}
nav button{flex:1;padding:12px;border:none;background:#1b2a30;color:#fff;font-weight:bold}
nav button.active{background:#00c853}
.page{display:none;padding:15px}
.page.active{display:block}

.box{background:rgba(255,255,255,.1);padding:15px;border-radius:16px;margin-bottom:15px}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:10px;border:none}
button.primary{background:#00c853;color:#fff;font-weight:bold}
button.red{background:#dc3545;color:#fff}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}
.card{background:#fff;color:#000;border-radius:14px;overflow:hidden}
.card img{width:100%;height:140px;object-fit:cover}
.info{text-align:center;padding:8px;font-size:13px}
.badge{padding:4px 8px;border-radius:20px;font-size:12px;margin:2px;display:inline-block}
.green{background:#28a745;color:#fff}
.redb{background:#dc3545;color:#fff}
.gray{background:#6c757d;color:#fff}
</style>
</head>

<body>

<header>üèè Admin Panel</header>

<nav>
<button class="active" onclick="openPage('teams')">Teams</button>
<button onclick="openPage('players')">Players</button>
<button onclick="openPage('assign')">Assign</button>
<button onclick="openPage('backup')">Backup</button>
</nav>

<!-- TEAMS -->
<div id="teams" class="page active">
  <div class="box">
    <h3>Add / Edit Team</h3>
    <input type="hidden" id="editTeamKey">
    <input id="tname" placeholder="Team Name">
    <input id="towner" placeholder="Team Owner">
    <input type="file" id="tlogo">
    <button class="primary" onclick="saveTeam()">Save Team</button>
  </div>

  <div class="box">
    <h3>Teams</h3>
    <div id="teamList" class="grid"></div>
  </div>
</div>

<!-- üÜï MANAGE TEAM -->
<div id="manageTeam" class="page">
  <div class="box">
    <h3 id="manageTitle">Manage Team</h3>
    <input type="hidden" id="manageKey">

    <h4>OWNER</h4>
    <input id="ownerName" placeholder="Owner Name">
    <input type="file" id="ownerImg">

    <h4>ICON 1</h4>
    <input id="i1name" placeholder="Name">
    <select id="i1cat">
      <option>Batting</option>
      <option>Bowling</option>
      <option>All-Rounder</option>
    </select>
    <input id="i1place" placeholder="Place">
    <input type="file" id="i1img">

    <h4>ICON 2</h4>
    <input id="i2name" placeholder="Name">
    <select id="i2cat">
      <option>Batting</option>
      <option>Bowling</option>
      <option>All-Rounder</option>
    </select>
    <input id="i2place" placeholder="Place">
    <input type="file" id="i2img">

    <h4>CAPTAIN</h4>
    <input id="cname" placeholder="Name">
    <select id="ccat">
      <option>Batting</option>
      <option>Bowling</option>
      <option>All-Rounder</option>
    </select>
    <input id="cplace" placeholder="Place">
    <input type="file" id="cimg">

    <button class="primary" onclick="saveLeaders()">Save</button>
    <button onclick="openPage('teams')">‚¨Ö Back</button>
  </div>
</div>

<!-- PLAYERS -->
<div id="players" class="page">
  <div class="box">
    <h3>Add / Edit Player</h3>
    <input id="pno" placeholder="Player Number">
    <input id="pname" placeholder="Player Name">
    <input id="prole" placeholder="Role">
    <input id="pplace" placeholder="Place / Native">
    <input type="file" id="pimg">
    <button class="primary" onclick="savePlayer()">Save Player</button>
  </div>

  <div class="box">
    <h3>Players (<span id="pc">0</span>)</h3>
    <input id="psearch" placeholder="Search Player" onkeyup="loadPlayers()">
    <div id="playerList" class="grid"></div>
  </div>
</div>

<!-- ASSIGN -->
<div id="assign" class="page">
  <div class="box">
    <h3>Assign Players</h3>
    <select id="assignTeam" onchange="loadAssign()"></select>
    <input id="asearch" placeholder="Search Player" onkeyup="loadAssign()">
    <div id="assignList" class="grid"></div>
  </div>
</div>

<!-- BACKUP -->
<div id="backup" class="page">
  <div class="box">
    <button class="primary" onclick="exportData()">Export Data</button>
    <input type="file" onchange="importData(this)">
  </div>
</div>

<script>
let players = JSON.parse(localStorage.getItem("players")) || {};
let teams   = JSON.parse(localStorage.getItem("teams")) || {};

function openPage(p){
 document.querySelectorAll(".page").forEach(x=>x.classList.remove("active"));
 document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
 document.getElementById(p).classList.add("active");
 event.target.classList.add("active");
}

/* üî• IMAGE COMPRESSION ‚Äî FIXED (CLEAR IMAGE) */
function compress(file, cb){
  let img = new Image();
  let reader = new FileReader();

  reader.onload = e => {
    img.onload = () => {
      let canvas = document.createElement("canvas");
      let MAX = 450;              // üîº increased size
      let w = img.width, h = img.height;

      if(w > h && w > MAX){
        h *= MAX / w; w = MAX;
      }else if(h > MAX){
        w *= MAX / h; h = MAX;
      }

      canvas.width = w;
      canvas.height = h;
      canvas.getContext("2d").drawImage(img,0,0,w,h);

      cb(canvas.toDataURL("image/jpeg", 0.85)); // üîº higher quality
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

/* TEAM */
function saveTeam(){
 let key = editTeamKey.value || tname.value.toUpperCase();
 if(!tname.value) return alert("Team name required");

 compress(tlogo.files[0], img=>{
  teams[key] = {name:tname.value.toUpperCase(), owner:towner.value, logo:img};
  localStorage.setItem("teams", JSON.stringify(teams));
  editTeamKey.value=""; tname.value=""; towner.value="";
  loadTeams();
 });
}
// üÜï OPEN MANAGE TEAM
function openManageTeam(k){
  manageKey.value = k;
  manageTitle.innerText = "Manage Team: " + teams[k].name;
  openPage("manageTeam");
}

// üÜï SAVE OWNER + ICONS + CAPTAIN
function saveLeaders(){
  let k = manageKey.value;
  if(!ownerImg.files[0] || !i1img.files[0] || !i2img.files[0] || !cimg.files[0]){
    return alert("All photos required");
  }

  compress(ownerImg.files[0], o=>{
  compress(i1img.files[0], i1=>{
  compress(i2img.files[0], i2=>{
  compress(cimg.files[0], c=>{
    teams[k].leaders = {
      owner:{ name: ownerName.value, img: o },
      icons:[
        { name:i1name.value, category:i1cat.value, place:i1place.value, img:i1 },
        { name:i2name.value, category:i2cat.value, place:i2place.value, img:i2 }
      ],
      captain:{ name:cname.value, category:ccat.value, place:cplace.value, img:c }
    };
    localStorage.setItem("teams", JSON.stringify(teams));
    alert("Team leaders saved");
  });});});});
}

function loadTeams(){
 teamList.innerHTML="";
 assignTeam.innerHTML="";
 Object.keys(teams).forEach(k=>{
  let t=teams[k];
  teamList.innerHTML+=`
  <div class="card" onclick="openManageTeam('${k}')">
    <img src="${t.logo}">
    <div class="info">
      <b>${t.name}</b><br>${t.owner}<br>
      <span class="badge green" onclick="editTeam('${k}')">EDIT</span>
      <span class="badge redb" onclick="deleteTeam('${k}')">DELETE</span>
    </div>
  </div>`;
  assignTeam.innerHTML+=`<option value="${k}">${t.name}</option>`;
 });
}

function editTeam(k){
 editTeamKey.value = k;
 tname.value = teams[k].name;
 towner.value = teams[k].owner;
 openPage("teams");
}

function deleteTeam(k){
 if(confirm("Delete team?")){
  Object.values(players).forEach(p=>{ if(p.team===k) p.team=""; });
  delete teams[k];
  localStorage.setItem("teams", JSON.stringify(teams));
  localStorage.setItem("players", JSON.stringify(players));
  loadTeams(); loadPlayers();
 }
}

/* PLAYER */
function savePlayer(){
 if(players[pno.value]){
  players[pno.value]={...players[pno.value],name:pname.value,role:prole.value,place:pplace.value};
  localStorage.setItem("players",JSON.stringify(players));
  loadPlayers();return;
 }
 compress(pimg.files[0],img=>{
  players[pno.value]={name:pname.value,role:prole.value,place:pplace.value,base:2000,team:"",img:img};
  localStorage.setItem("players",JSON.stringify(players));
  loadPlayers();
 });
}

function loadPlayers(){
 playerList.innerHTML="";
 let s=(psearch.value||"").toUpperCase();
 let k=Object.keys(players).filter(n=>n.includes(s)||players[n].name.toUpperCase().includes(s));
 pc.innerText=k.length;
 k.forEach(n=>{
  let p=players[n];
  playerList.innerHTML+=`
  <div class="card">
   <img src="${p.img}">
   <div class="info">
    <b>#${n}</b><br>${p.name}<br>${p.place}<br>
    BASE:2000<br>
    TEAM:${p.team||"NONE"}<br>
    <span class="badge green" onclick="editPlayer('${n}')">EDIT</span>
    <span class="badge redb" onclick="delPlayer('${n}')">DELETE</span>
   </div>
  </div>`;
 });
}

function editPlayer(n){
 let p=players[n];
 pno.value=n; pname.value=p.name; prole.value=p.role; pplace.value=p.place;
 openPage("players");
}

function delPlayer(n){
 if(confirm("Delete player?")){
  delete players[n];
  localStorage.setItem("players",JSON.stringify(players));
  loadPlayers();
 }
}

/* ASSIGN */
function loadAssign(){
 assignList.innerHTML="";
 let t=assignTeam.value, s=(asearch.value||"").toUpperCase();
 Object.keys(players).forEach(n=>{
  let p=players[n];
  if(n.includes(s)||p.name.toUpperCase().includes(s)){
   let btn="";
   if(!p.team) btn=`<span class="badge green" onclick="add('${n}')">ADD</span>`;
   else if(p.team===t) btn=`<span class="badge redb" onclick="rem('${n}')">REMOVE</span>`;
   else btn=`<span class="badge gray">IN ${p.team}</span>`;
   assignList.innerHTML+=`
   <div class="card">
    <img src="${p.img}">
    <div class="info">#${n}<br>${p.name}<br>${btn}</div>
   </div>`;
  }
 });
}
function add(n){players[n].team=assignTeam.value;localStorage.setItem("players",JSON.stringify(players));loadAssign();loadPlayers();}
function rem(n){players[n].team="";localStorage.setItem("players",JSON.stringify(players));loadAssign();loadPlayers();}

/* BACKUP */
function exportData(){
 let a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([JSON.stringify({players,teams})]));
 a.download="auction_backup.json";a.click();
}
function importData(i){
 let r=new FileReader();
 r.onload=e=>{
  let d=JSON.parse(e.target.result);
  players=d.players||{}; teams=d.teams||{};
  localStorage.setItem("players",JSON.stringify(players));
  localStorage.setItem("teams",JSON.stringify(teams));
  loadTeams(); loadPlayers();
 };
 r.readAsText(i.files[0]);
}

loadTeams(); loadPlayers();
</script>

</body>
</html>
